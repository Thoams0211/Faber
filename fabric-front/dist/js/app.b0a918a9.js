(function(e){function t(t){for(var o,a,s=t[0],c=t[1],u=t[2],d=0,p=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&p.push(r[a][0]),r[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);i&&i(t);while(p.length)p.shift()();return l.push.apply(l,u||[]),n()}function n(){for(var e,t=0;t<l.length;t++){for(var n=l[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(o=!1)}o&&(l.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={app:0},l=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var i=c;l.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},5033:function(e){e.exports=JSON.parse('{"container":{"width":550,"height":550},"blocks":[{"top":100,"left":100,"zIndex":1,"key":"text"},{"top":200,"left":200,"zIndex":1,"key":"button"},{"top":300,"left":300,"zIndex":1,"key":"input"}]}')},"56d7":function(e,t,n){"use strict";n.r(t);var o=n("7a23");const r={class:"app"};function l(e,t,n,l,a,s){const c=Object(o["N"])("Editor");return Object(o["G"])(),Object(o["m"])("div",r,[Object(o["p"])(c,{modelValue:l.state,"onUpdate:modelValue":t[0]||(t[0]=e=>l.state=e)},null,8,["modelValue"])])}var a=n("5033"),s=(n("a818"),Object(o["q"])({props:{block:{type:Object}},setup(e){const t=Object(o["i"])(()=>({top:e.block.top+"px",left:e.block.left+"px",zIndex:""+e.block.zIndex})),n=Object(o["t"])("config"),r=Object(o["J"])(null);return Object(o["D"])(()=>{let{offsetWidth:t,offsetHeight:n}=r.value;e.block.alignCenter&&(e.block.left=e.block.left-t/2,e.block.top=e.block.top-n/2,e.block.alignCenter=!1),e.block.width=t,e.block.height=n}),()=>{const l=n.componentMap[e.block.key],a=l.render();return Object(o["p"])("div",{class:"editor-block",style:t.value,ref:r},[a])}}})),c=n("4979"),u=n.n(c),i=n("1344");const d=Object(i["a"])();function p(e,t){let n=null;const o=e=>{e.dataTransfer.dropEffect="move"},r=e=>{e.preventDefault()},l=e=>{e.dataTransfer.dropEffect="none"},a=e=>{let o=t.value.blocks;t.value={...t.value,blocks:[...o,{top:e.offsetY,left:e.offsetX,zIndex:1,key:n.key,alignCenter:!0}]},n=null},s=(t,s)=>{e.value.addEventListener("dragenter",o),e.value.addEventListener("dragover",r),e.value.addEventListener("dragleave",l),e.value.addEventListener("drop",a),n=s,d.emit("start")},c=t=>{e.value.removeEventListener("dragenter",o),e.value.removeEventListener("dragover",r),e.value.removeEventListener("dragleave",l),e.value.removeEventListener("drop",a),d.emit("end")};return{dragstart:s,dragend:c}}function f(e,t){const n=Object(o["J"])(-1),r=Object(o["i"])(()=>e.value.blocks[n.value]),l=Object(o["i"])(()=>{let t=[],n=[];return e.value.blocks.forEach(e=>(e.focus?t:n).push(e)),{focus:t,unfocused:n}}),a=()=>{e.value.blocks.forEach(e=>e.focus=!1)},s=()=>{a(),n.value=-1},c=(e,o,r)=>{e.preventDefault(),e.stopPropagation(),e.shiftKey?l.value.focus.length<=1?o.focus=!0:o.focus=!o.focus:o.focus||(a(),o.focus=!0),n.value=r,t(e)};return{blockMousedown:c,containerMousedown:s,focusData:l,lastSelectBlock:r}}function b(e,t,n){let r={startX:0,startY:0,dragging:!1},l=Object(o["I"])({x:null,y:null});const a=o=>{const{width:l,height:a}=t.value;r={startX:o.clientX,startY:o.clientY,startLeft:t.value.left,startTop:t.value.top,dragging:!1,startPos:e.value.focus.map(({top:e,left:t})=>({top:e,left:t})),lines:(()=>{const{unfocused:t}=e.value;let o={x:[],y:[]};return[...t,{top:0,left:0,width:n.value.container.width,height:n.value.container.height}].forEach(e=>{const{top:t,left:n,width:r,height:s}=e;o.y.push({showTop:t,top:t}),o.y.push({showTop:t,top:t-a}),o.y.push({showTop:t+s/2,top:t+s/2-a/2}),o.y.push({showTop:t+s,top:t+s}),o.y.push({showTop:t+s,top:t+s-a}),o.x.push({showLeft:n,left:n}),o.x.push({showLeft:n+r,left:n+r}),o.x.push({showLeft:n+r/2,left:n+r/2-l/2}),o.x.push({showLeft:n+r,left:n+r-l}),o.x.push({showLeft:n,left:n-l})}),o})()},document.addEventListener("mousemove",s),document.addEventListener("mouseup",c)},s=t=>{let{clientX:n,clientY:o}=t;r.dragging||(r.dragging=!0,d.emit("start"));let a=n-r.startX+r.startLeft,s=o-r.startY+r.startTop,c=null,u=null;for(let e=0;e<r.lines.y.length;e++){const{top:t,showTop:n}=r.lines.y[e];if(Math.abs(t-s)<5){c=n,o=r.startY-r.startTop+t;break}}for(let e=0;e<r.lines.x.length;e++){const{left:t,showLeft:o}=r.lines.x[e];if(Math.abs(t-a)<5){u=o,n=r.startX-r.startLeft+t;break}}l.x=u,l.y=c;let i=n-r.startX,p=o-r.startY;e.value.focus.forEach((e,t)=>{e.top=r.startPos[t].top+p,e.left=r.startPos[t].left+i})},c=e=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",c),l.x=null,l.y=null,r.dragging&&d.emit("end")};return{mousedown:a,markLine:l}}function v(e){const t={current:-1,queue:[],commands:{},commandArray:[],destroyArray:[]},n=e=>{t.commandArray.push(e),t.commands[e.name]=()=>{const{redo:n,undo:o}=e.execute();if(n(),!e.pushQueue)return;let{queue:r,current:l}=t;r.length>0&&(r=r.slice(0,l+1),t.queue=r),r.push({redo:n,undo:o}),t.current=l+1,console.log(r)}};n({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){let e=t.queue[t.current+1];e&&(e.redo&&e.redo(),t.current++)}}}}),n({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(-1==t.current)return;let e=t.queue[t.current];e&&(e.undo&&e.undo(),t.current--)}}}}),n({name:"drag",pushQueue:!0,init(){this.before=null;const n=()=>{this.before=u()(e.value.blocks)},o=()=>{t.commands.drag()};return d.on("start",n),d.on("end",o),()=>{d.off("start",n),d.off("end",o)}},execute(){let t=this.before,n=e.value.blocks;return{redo(){e.value={...e.value,blocks:n}},undo(){e.value={...e.value,blocks:t}}}}});const r=(()=>{const e={90:"z",89:"y"},n=n=>{const{ctrlKey:o,keyCode:r}=n;let l=[];o&&l.push("ctrl"),l.push(e[r]),l=l.join("+"),t.commandArray.forEach(({keyboard:e,name:o})=>{e&&e===l&&(t.commands[o](),n.preventDefault())})},o=()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)});return o})();return(()=>{t.destroyArray.push(r()),t.commandArray.forEach(e=>e.init&&t.destroyArray.push(e.init()))})(),Object(o["E"])(()=>{t.destroyArray.forEach(e=>e&&e())}),t}var h=Object(o["q"])({props:{modelValue:{type:Object}},emits:["update:modelValue"],setup(e,t){const n=Object(o["i"])({get(){return e.modelValue},set(e){t.emit("update:modelValue",u()(e))}}),r=Object(o["i"])(()=>({width:n.value.container.width+"px",height:n.value.container.height+"px"})),l=Object(o["t"])("config"),a=Object(o["J"])(null),{dragstart:c,dragend:i}=p(a,n);let{blockMousedown:d,focusData:h,containerMousedown:m,lastSelectBlock:g}=f(n,e=>{y(e)}),{mousedown:y,markLine:O}=b(h,g,n);const{commands:j}=v(n),k=[{label:"撤销",icon:"icon-back",handler:()=>j.undo()},{label:"重做",icon:"icon-forward",handler:()=>j.redo()}];return()=>Object(o["p"])("div",{class:"editor"},[Object(o["p"])("div",{class:"editor-left"},[l.componentList.map(e=>Object(o["p"])("div",{class:"editor-left-item",draggable:!0,onDragstart:t=>c(t,e),onDragend:i},[Object(o["p"])("span",null,[e.label]),Object(o["p"])("div",null,[e.preview()])]))]),Object(o["p"])("div",{class:"editor-top"},[k.map((e,t)=>Object(o["p"])("div",{class:"editor-top-button",onClick:e.handler},[Object(o["p"])("i",{class:e.icon},null),Object(o["p"])("span",null,[e.label])]))]),Object(o["p"])("div",{class:"editor-right"},[Object(o["o"])("属性控制栏目")]),Object(o["p"])("div",{class:"editor-container"},[Object(o["p"])("div",{class:"editor-container-canvas"},[Object(o["p"])("div",{class:"editor-container-canvas__content",style:r.value,ref:a,onMousedown:m},[n.value.blocks.map((e,t)=>Object(o["p"])(s,{class:e.focus?"editor-block-focus":"",block:e,onMousedown:n=>d(n,e,t)},null)),null!==O.x&&Object(o["p"])("div",{class:"line-x",style:{left:O.x+"px"}},null),null!==O.y&&Object(o["p"])("div",{class:"line-y",style:{top:O.y+"px"}},null)])])])])}}),m=n("7864"),g=n("bcf0");function y(){const e=[],t={};return{componentList:e,componentMap:t,register:n=>{e.push(n),t[n.key]=n}}}let O=y();O.register({label:"这里是文本",preview:()=>"文本",render:()=>"渲染文本",key:"text"}),O.register({label:"按钮",preview:()=>Object(o["p"])(m["a"],null,{default:()=>[Object(o["o"])("预览按钮")]}),render:()=>Object(o["p"])(m["a"],null,{default:()=>[Object(o["o"])("渲染按钮")]}),key:"button"}),O.register({label:"输入框",preview:()=>Object(o["p"])(m["b"],{placeholder:"预览输入框"},null),render:()=>Object(o["p"])(m["b"],{placeholder:"渲染输入框"},null),key:"input"}),O.handleDragEnd=async()=>{try{const e="http://127.0.0.1:5000",t={message:"Drag ended, sending message to backend..."},n=await g["a"].post(e,t);console.log("Backend response:",n.data)}catch(e){console.error("Error sending POST request:",e)}};var j={components:{Editor:h},setup(){const e=Object(o["J"])(a);return Object(o["H"])("config",O),{state:e}}},k=(n("7e7e"),n("6b0d")),w=n.n(k);const x=w()(j,[["render",l]]);var E=x;n("7dd6");Object(o["j"])(E).mount("#app")},"7e7e":function(e,t,n){"use strict";n("c2ab")},a818:function(e,t,n){},c2ab:function(e,t,n){}});
//# sourceMappingURL=app.b0a918a9.js.map